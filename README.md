Creative Programming and Computing
A. Y. 2022-2023
Abstract of the project

# Ego
Ego is a project that is meant to explore the idea of human perception, in particular the idea of identity and self 
consciousness and the way it is distorted and biased.
We implemented this project as a webapp to make the experience available to everyone, but it can also be imagined in 
the context of an artistic installation: the user's first approach would be defined by the vision of a
cloud of swirling particles, while an undefined drone sound is playing. Once the user is close enough to be detected by 
our system the cloud will start to slowly morph into a shape resembling its face: the user is now witnessing their 
identity take shape. A repeating melody would be heard, whose generation is based on the user's face, in particular on 
their somatic traits and their current mood. The intrigued user might now get even closer, in which case they'll hear 
the music become more and more intense, in a higher pitch and faster, representing an ever-growing feedback loop of self
consciousness. The final phase of Ego will show the user their face being morphed into a new shape, reminiscent of a 
Rorschach test, to finally express the idea of the distortion of the self caused by the filtering of external point of 
view.

## Coding design principles



## Graphics design
  
### Swirling particles

### Face detection

### Final shape generation
SVG, perlin noise, symmetric physics

Perlin noise: The algorithm fills a square, drawing pixel by pixel. Each pixel's greyscale value is determined by 2D 
Perlin noise, evaluated in a point proportional to the pixels' coordinates. Additionally, a pixels' intensity fades 
away as the distance from the origin grows. The result so far is an image resembling a circular cloud, with hazy 
borders. The image is then mirrored vertically and horizontally. The final step of our algorithm is to apply a 
threshold filter, finally obtaining a symmetric shape with sharp borders.



## Music generation
We implemented an algorithm for real time music generation. At its core is a Markov chain of second order, used for 
generating scale degrees. In practice, it corresponds to a 7x7x7 table whose columns are the probabilities for the 7 
scale degrees to be generated and whose rows are the 7x7 possible combinations of 2 previously generated degrees. 
This table is filled by mapping 343 face landmarks on it, establishing a connection between the user's face 
characteristics and the music probabilistic model. When a new face is detected, a melody of random length is generated 
based on this model. The melody is then played repeatedly and occasionally mutated over time, with some probability for
the mutation to happen. When a mutation happens, a new scale degree or a new duration substitutes the old one. In 
addition to this melody we generate a bass and some chords. The chords are generated by randomly choosing a scale 
degree and building a triad or a 7th chord on top of it, inside the current scale. The detected sentiment is mapped to 
one of 7 possible scales, corresponding more or less the user's mood. Pitches and durations are generated separately, 
with another Markov chain of order 1 taking care of the duration generation. This implementation of Markov's chains is 
filled with predefined probability values. When a new face is detected a couple of parameters are randomized, in order 
to reinforce the idea of tying the user's identity to the generated composition. Among these parameters are the bpm, 
melody and bass register, chance for a melody to be altered, chance for bass and chords to be played. An estimation of
the users' distance further controls the BPM and randomizes the octaves. The distance and the confidence of the model 
used for sentiment detection are also used as sound design parameters in Max.



## OSC integration




## Sound design

### Max
The main patch in Max is divided into the following sections:
- OSC Receiver
- Audio Generation
- Mixer
- Master Effects

The main objects that make up the patch are:
- Oscillators: mainly used for the generation of desired sounds.
- `mc.matrix~` object: which we mainly use to create effect sends that will be mixed to the dry signal.
- Scale object: which allows us to map parameters in a given range.
- KiloHearts Essential Plugins: used for sound effects.

Concerning the sound design of the various instruments (Arpeggio, Bass, Drone) we started from a template of Additive Synthesis created by us and then modified it in order to achieve the desired sound.
The template consists of 4 oscillators in which we can decide each waveform, envelope and amplitude. We also have several LFOs available for each of them, both for frequency modulation and amplitude modulation. 
Next we find an EQ that allows us to choose any type of filter and change its parameters (cut, gain, Q) and finally our effect plugins.

For the noise drone we used a sample. This sample is first added into a buffer, and then using the Stretch~ object we modify the buffer contents in a "destructive" way both in terms of pitch and time.
Next we generate 16 channels of a signal and we divert them and then multiply them by the sample inserted previously in the buffer. This makes it possible to generate a particular noise effect. In the end, we apply the effect sends to the noise drone.

When it comes to receiving OSC messages, in addition to notes messages and control messages, we have 4 sound design parameters:
- Parameter 1 : corresponds to the Bloom (post processing effect) intensity, mapped in Max to the Depth, Rate, Mix parameters of the Flanger in the subpatch `TryPoly_CPAC` and the Cut of the lowpass filter.
- Parameter 2 :  corresponds to the particle Noise Amplitude and is mapped to the cutoff of the lowpass filter and to the Amplitude of the pink noise in the `SynthAddCpac_DRONE_DO` Subpatch, and to the Mix parameter of Ensemble plugin in the `Structure_CPAC` patch.
- Parameter 3: corresponds to the Confidence of Sentiment Detection and is mapped to the Spread parameter of Phase Distorsion plugin in the `SynthAddCpac_DRONE_DO` subpatch  and to the detune parameter of Ensemble Plugin in the `Structure_CPAC` patch.
- Parameter 4: corresponds to the face distance and is mapped to the amplitude of the fourth oscillator of the `SynthAddCpac_DRONE_DO` subpath e and to the adsr’s attack and the amplitude of the `SynthAddCpac_ARP` subpatch.

### ToneJS




## Roadmap

### Prototype after the hackathon
- Generate a face mesh from the webcam’s input in real time ![100%](https://progress-bar.dev/100) &rarr; **Matteo**
- ~~Use face’s to generate a grammar string for music composition~~
- ~~Define a grammar for the composition~~
- Generate music in PureData/Max via OSC ![85%](https://progress-bar.dev/85) &rarr; **Samuele**

### Final project
- Face triangulation ![100%](https://progress-bar.dev/100) &rarr; **Matteo**
- ~~Image's object contour recognition~~
- Continuous loop morphing between face and abstract shapes ![100%](https://progress-bar.dev/100) &rarr; **Matteo**
- Define markov chain for the composition ![100%](https://progress-bar.dev/100) &rarr; **Sebastian**
- Alter sound based on the heads spatial parameters ![100%](https://progress-bar.dev/100) &rarr; **Sebastian**
- OSC integration ![100%](https://progress-bar.dev/100) &rarr; **Sebastian** + **Samuele**
- Real time generation of morphing target images ![100%](https://progress-bar.dev/100)
  - SVG morph target loader ![100%](https://progress-bar.dev/100) &rarr; **Matteo**
  - Perlin noise symmetric image generator ![100%](https://progress-bar.dev/100) &rarr; **Sebastian** + **Matteo**
  - Processing based morph target generator ![100%](https://progress-bar.dev/100) &rarr; **Tommaso**
- Splash screen ![75%](https://progress-bar.dev/75) &rarr; **Matteo**
  - **TODO** - Modal view with experience guide
- Noise automation during loop's animation ![20%](https://progress-bar.dev/20) &rarr; **Matteo + Sebastian**
- Improve rendering and colours ![50%](https://progress-bar.dev/50)
- ToneJS player if OSC not available ![50%](https://progress-bar.dev/50)
- README + Presentation slides ![0%](https://progress-bar.dev/0)
- Handle multiple faces at the same time ![0%](https://progress-bar.dev/0)
